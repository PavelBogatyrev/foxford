(window.webpackJsonp=window.webpackJsonp||[]).push([[136],{F4nM:function(e,t,n){"use strict";n.r(t);var r=n("VTBJ"),i=n("q1tI"),o=n("egw8"),c=n("4b23"),a=n("1OyB"),s=n("Ji7U"),u=n("LK+K"),l=n("JrP0"),f=n("KQm4"),p=n("Wa0/"),d=n("OGwt"),_=n("I5QO"),b=n("5yP7"),h=n("uiCA"),v=n("w9BP"),S=n("4W9V"),m=n("7op5").a.get("Popup alerts service"),y=Object(p.e)("popup alerts domain");y.onCreateEffect((function(e){e.fail.watch((function(e){Object(S.a)({error:e,logger:m})})),e.watch((function(t){m.debug(e.getType(),t)}))}));var O=n("HaE+"),g=n("o0o1"),k=n.n(g),E=n("7oKd"),C=function(){var e=Object(O.a)(k.a.mark((function e(){var t,n;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E.a.get("/api/popup_alerts",{camelize:!1});case 2:return t=e.sent,n=t.data,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),j=function(){var e=Object(O.a)(k.a.mark((function e(t){var n,r;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E.a.get("/api/popup_alerts/".concat(t),{camelize:!1});case 2:return n=e.sent,r=n.data,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),A=function(){var e=Object(O.a)(k.a.mark((function e(t){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E.a.post("/api/popup_alerts/".concat(t,"/mark_viewed"));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),w=y.createEvent("initialize popup alerts"),P=y.createEvent("terminate popup alerts"),I=y.createEvent("fetch popup alerts"),T=y.createEvent("fetch popup alert by id"),R=y.createEvent("mark popup alert seen"),N=y.createEffect({handler:function(){return Object(O.a)(k.a.mark((function e(){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",C());case 1:case"end":return e.stop()}}),e)})))()}}),L=y.createEffect({handler:function(e){return Object(O.a)(k.a.mark((function t(){return k.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",j(e));case 1:case"end":return t.stop()}}),t)})))()}}),M=y.createEffect({handler:function(e){return Object(O.a)(k.a.mark((function t(){return k.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",A(e));case 1:case"end":return t.stop()}}),t)})))()}}),U=_.a.getStore(),D=y.createStore(!1),B=Object(p.c)(b.a.getStore(),D,(function(e,t){var n=e.isLoggedIn,r=e.user;return t&&n?"popup_alerts#".concat(r.id):null})),F=y.createStore([]);F.on(N.doneData,(function(e,t){return t})).on(L.doneData,(function(e,t){return[].concat(Object(f.a)(e),[t])})).on(M,(function(e,t){return e.filter((function(e){return e.id!==t}))})),D.on(w,(function(){return!0})).reset(P),Object(p.k)({source:I,filter:Object(p.c)(U,N.pending,(function(e,t){return e.isLoggedIn&&!t})),target:N}),Object(p.k)({source:T,filter:U.map((function(e){return e.isLoggedIn})),target:L}),Object(p.j)({from:Object(p.p)(F,R,(function(e,t){return{markedId:t,popupAlerts:e}})).filterMap((function(e){var t=e.popupAlerts,n=e.markedId;return t.find((function(e){return e.id===n}))?n:void 0})),to:M}),Object(p.j)({from:[h.SocketService.onConnect,h.SocketService.onRefreshToken],to:I}),w.watch((function(){Object(d.onVisible)((function(){I()}))})),B.watch((function(e){null!==e&&h.SocketService.subscribe(e,(function(e){var t=e.type,n=e.payload;"popup_created"===t&&T(n.id),"popup_viewed"===t&&R(n.id)}))}));var W=F.map((function(e){return e.length>0})),Y=Object(p.c)({hasPopupAlerts:W,onlyPreferred:v.c,popupAlerts:F}),x=new(function(e){Object(s.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(a.a)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).getPopupAlerts=I,e.markSeen=M,e.initialize=w,e.terminate=P,e}return n}(l.a))(Y),z=n("tRib"),G=n("MKeS"),K=Object.freeze({AWARD_BADGE_REWARD:"award_badge_reward",INTRO_LESSON_VISIT_CONFIRM:"intro_lesson_visit_confirm",LEVEL_UP:"level_up",MESSAGE:"message",MULTI_DAYS_STREAK:"multi_days_streak",NEW_ASSIGNED_INTRO_LESSON:"new_assigned_intro_lesson",OLYMPIAD_COACH:"olympiad_coach",OLYMPIAD_COURSE:"olympiad_course",OLYMPIAD_PROMO:"olympiad_promo",SELECT_GROUP_TEMPLATE:"select_group_template"}),V=n("ODXe"),J=n("z8gL"),H=function(e){return e.user.isAgent},Q=function(e){return"successful"===e.popupAlerts.find((function(e){return"multi_days_streak"===e.type})).status},X=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Object(J.a)([Object(z.a)(H)].concat(t))},q=Object(G.a)((function(){return n.e(130).then(n.bind(null,"lbYZ"))}),{fallback:!1}),Z=Object(G.a)((function(){return Promise.all([n.e(0),n.e(5),n.e(129)]).then(n.bind(null,"q1cM"))}),{fallback:!1}),$=Object(G.a)((function(){return Promise.all([n.e(4),n.e(5),n.e(132)]).then(n.bind(null,"z+fz"))}),{fallback:!1}),ee=Object(G.a)((function(){return Promise.all([n.e(0),n.e(127)]).then(n.bind(null,"lVH3"))}),{fallback:!1}),te=Object(G.a)((function(){return Promise.all([n.e(0),n.e(126)]).then(n.bind(null,"GmB4"))}),{fallback:!1,resolveComponent:function(e){return e.AwardBadgeToast}}),ne=Object(G.a)((function(){return Promise.all([n.e(0),n.e(135)]).then(n.bind(null,"QWsH"))}),{fallback:!1,resolveComponent:function(e){return e.WinStreakDailyToast}}),re=Object(G.a)((function(){return n.e(134).then(n.bind(null,"u1ki"))}),{fallback:!1,resolveComponent:function(e){return e.WinStreakAchievement}}),ie=Object(G.a)((function(){return n.e(131).then(n.bind(null,"NoSK"))}),{fallback:!1,resolveComponent:function(e){return e.NewIntroLessonToast}}),oe=Object(G.a)((function(){return n.e(128).then(n.bind(null,"DZ8u"))}),{fallback:!1,resolveComponent:function(e){return e.IntroLessonStartReminderToast}}),ce=Object(G.a)((function(){return Promise.all([n.e(0),n.e(1),n.e(16),n.e(133)]).then(n.bind(null,"Ya0w"))}),{fallback:!1,resolveComponent:function(e){return e.SelectGroupTemplate}}),ae=[{Component:q,isFullScreen:!0,priority:50,type:K.MESSAGE},{Component:Z,condition:X(),isFullScreen:!0,priority:200,transformProps:function(e){if(e.type===K.LEVEL_UP){var t=e.id,n=e.img;return{level:e.level,shareOptions:{id:t,image:n}}}},type:K.LEVEL_UP},{Component:$,condition:X(),isFullScreen:!0,priority:30,type:K.OLYMPIAD_PROMO},{Component:ee,condition:X(),isFullScreen:!0,priority:30,type:K.OLYMPIAD_COURSE},{Component:te,condition:X(),isFullScreen:!1,priority:200,type:K.AWARD_BADGE_REWARD},{Component:ne,condition:X(Object(z.a)(Q)),isFullScreen:!1,priority:100,transformProps:function(e){if(e.type===K.MULTI_DAYS_STREAK){var t=e.id,n=e.completed_days_count,r=e.total_days_count,i=e.gift_discount,o=e.gift_type;return{day:n||0,giftBonusesAmount:e.gift_bonuses_amount,giftDiscount:i,giftType:o,id:t,successful:"completed_for_today"===e.status,totalDaysCount:r}}},type:K.MULTI_DAYS_STREAK},{Component:re,condition:X(Q),isFullScreen:!0,priority:50,transformProps:function(e){if(e.type===K.MULTI_DAYS_STREAK){var t=e.gift_url,n=e.total_days_count,r=e.gift_discount,i=e.gift_type;return{giftBonusesAmount:e.gift_bonuses_amount,giftDiscount:r,giftType:i,giftUrl:t,totalDaysCount:n}}},type:K.MULTI_DAYS_STREAK},{Component:ie,condition:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Object(J.a)(t)}(),isFullScreen:!0,isPreferred:!0,priority:20,transformProps:function(e){if(e.type===K.NEW_ASSIGNED_INTRO_LESSON){var t=e.title,n=e.message,r=e.lesson_id;return{classroomPath:e.classroom_path,lessonId:r,message:n||"",title:t||""}}},type:K.NEW_ASSIGNED_INTRO_LESSON},{Component:oe,condition:X(),isFullScreen:!0,isPreferred:!0,priority:20,transformProps:function(e){if(e.type===K.INTRO_LESSON_VISIT_CONFIRM){var t=e.title,n=e.message,r=e.lesson_id;return{classroomPath:e.classroom_path,lessonId:r,message:n||"",title:t||""}}},type:K.INTRO_LESSON_VISIT_CONFIRM},{Component:ce,condition:X(),isFullScreen:!0,priority:30,transformProps:function(e){if(e.type===K.SELECT_GROUP_TEMPLATE){var t=e.title,n=e.message;return{courseId:e.course_id,message:n||"",title:t||""}}},type:K.SELECT_GROUP_TEMPLATE}],se=n("nKUr"),ue=ae.map((function(e){return Object(r.default)(Object(r.default)({},e),{},{componentId:Object(c.b)()})}));t.default=function(){var e=Object(o.e)(b.a.getUserStore()),t=Object(o.e)(x.getStore()),n=t.popupAlerts,c=t.hasPopupAlerts,a=t.onlyPreferred;Object(i.useEffect)((function(){return x.initialize(),function(){x.terminate()}}),[]);var s=Object(i.useMemo)((function(){return function(e,t){var n=t.popupAlerts.map((function(e){return e.type}));return e.reduce((function(e,r){var i=Object(V.a)(e,2),o=i[0],c=i[1],a=r.type,s=r.condition,u=r.isFullScreen,l=r.isPreferred,f=void 0!==l&&l,p=r.priority;if((!t.onlyPreferred||f)&&n.includes(a)&&("function"!==typeof s||s(t))){if(u&&(!o||p<o.priority))return[r,c];if(!u&&(!c||p<c.priority))return[o,r]}return e}),[]).filter(Boolean)}(ue,{onlyPreferred:a,popupAlerts:n,user:e})}),[n,e,a]);return c?Object(se.jsx)(se.Fragment,{children:s.map((function(e){var t=e.Component,o=e.componentId,c=e.type,a=e.transformProps;return Object(i.createElement)(t,Object(r.default)(Object(r.default)({},function(e,t,n){var i=e.find((function(e){return e.type===t}));if(i){var o="function"===typeof n?n(i):i;return Object(r.default)(Object(r.default)({},o),{},{markSeen:function(){x.markSeen(i.id)}})}}(n,c,a)),{},{key:o}))}))}):null}},"W/2M":function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n("7op5"),i=n("YA7g"),o=r.a.get(i.c)},"Y/3w":function(e,t,n){"use strict";n.d(t,"b",(function(){return s})),n.d(t,"a",(function(){return u}));var r=n("Wa0/"),i=n("4W9V"),o=n("W/2M"),c=n("YA7g"),a=Object(r.e)(c.c);a.onCreateEffect((function(e){e.fail.watch((function(e){Object(i.a)({error:e,logger:o.a})}))}));var s=a.createEvent("socket token refreshed"),u=a.createEvent("socket token connected")},kSXv:function(e,t){},uiCA:function(e,t,n){"use strict";n.d(t,"SocketService",(function(){return v}));var r=n("HaE+"),i=n("1OyB"),o=n("vuIU"),c=n("o0o1"),a=n.n(c),s=n("eG+7"),u=n.n(s),l=n("zH15"),f=n.n(l),p=n("5yP7"),d=n("nJO0"),_=n("YA7g"),b=n("Y/3w"),h=n("W/2M"),v=(n("kSXv"),new(function(){function e(){Object(i.a)(this,e),this._isInitialize=!1,this._token=null,this._subscriptions={},this._subscriptionsCount=0,this._processChannel\u0421ancellers={},this._channelsCollection=[],this.onRefreshToken=b.b,this.onConnect=b.a}return Object(o.a)(e,[{key:"_create",value:function(){var e=this;if(void 0===this._centrifuge){try{this._centrifuge=new u.a(_.d,{debug:_.a,onRefresh:function(){var t=Object(r.a)(a.a.mark((function t(n,r){var i;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.a.getUserMe();case 2:i=t.sent,r({data:{token:i.webSocketNotificationsJwt},status:200}),e.onRefreshToken();case 5:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),onRefreshFailed:function(){h.a.error("Failed to refresh the Centrifuge token")},refreshAttempts:20,sockjs:f.a}),this._centrifuge.setToken(this._token),this._centrifuge.on("disconnect",(function(e){e.reconnect||"client"===e.reason||h.a.error("Centrifuge connection is closed and will not be reconnected",{reason:e.reason})}))}catch(t){h.a.error("Failed to create the Centrifuge instance",{reason:t.toString()})}this._processChannel\u0421ancellers.centrifuge=d.SharedProcessService.subscribe((function(t){var n=t.type,r=t.payload;n===_.b.SUBSCRIBE&&e._subscribe(r.channelName),n===_.b.UNSUBSCRIBE&&e._unsubscribe(r.channelName)}),[_.c]),this._channelsCollection.forEach((function(t){e._subscribe(t)}))}}},{key:"_destroy",value:function(){void 0!==this._centrifuge&&this._centrifuge.isConnected()&&(this._centrifuge.disconnect(),this._processChannel\u0421ancellers.centrifuge(),this._centrifuge=void 0,this._subscriptions={},this._subscriptionsCount=0)}},{key:"_setToken",value:function(e){this._token=e,null===e?this._destroy():void 0!==this._centrifuge&&this._centrifuge.setToken(e)}},{key:"_connect",value:function(){this._centrifuge&&this._centrifuge.isConnected()||0===this._subscriptionsCount||this._centrifuge.connect()}},{key:"_isAvailable",value:function(){return Boolean(this._token)}},{key:"_addSubscription",value:function(e,t){this._subscriptions[e]=t,this._subscriptionsCount+=1}},{key:"_removeSubscription",value:function(e){this._subscriptions[e]=void 0,this._subscriptionsCount-=1}},{key:"_subscribe",value:function(e){if(this._create(),void 0===this._subscriptions[e]){var t=this._centrifuge.subscribe(e,(function(t){d.SharedProcessService.postMessage({module:_.c,payload:t.data,type:e})}));this._addSubscription(e,t)}else{this._subscriptions[e].subscribe()}this._connect(),this.onConnect()}},{key:"_unsubscribe",value:function(e){var t=this._subscriptions[e];void 0!==t&&(t.unsubscribe(),this._removeSubscription(e),this._centrifuge&&0===this._subscriptionsCount&&this._centrifuge.disconnect())}},{key:"subscribe",value:function(){var e=Object(r.a)(a.a.mark((function e(t,n){var r=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._isAvailable()){e.next=3;break}return h.a.error("SocketService is not available",{channelName:t}),e.abrupt("return");case 3:return e.next=5,d.SharedProcessService.add(_.c,(function(){return r._create(),function(){r._destroy()}}));case 5:this._processChannel\u0421ancellers[t]||(d.SharedProcessService.postMessage({module:_.c,payload:{channelName:t},type:_.b.SUBSCRIBE}),this._processChannel\u0421ancellers[t]=d.SharedProcessService.subscribe((function(e){var t=e.payload,r=t.type,i=t.payload;n({payload:i,type:r})}),[t]));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"unsubscribe",value:function(e){if(this._isAvailable()){d.SharedProcessService.postMessage({module:_.c,payload:{channelName:e},type:_.b.UNSUBSCRIBE});var t=this._processChannel\u0421ancellers[e];t&&t()}else h.a.error("SocketService is not available")}},{key:"initialize",value:function(){var e=this;this._isInitialize||(this._isInitialize=!0,p.a.getUserStore().map((function(e){var t;return null!==(t=e.webSocketNotificationsJwt)&&void 0!==t?t:null})).watch((function(t){e._setToken(t)})),d.SharedProcessService.subscribe((function(t){var n=t.type,r=t.payload;switch(n){case _.b.SUBSCRIBE:e._channelsCollection.includes(r.channelName)||e._channelsCollection.push(r.channelName);break;case _.b.UNSUBSCRIBE:e._channelsCollection=e._channelsCollection.filter((function(e){return e!==r.channelName}))}}),[_.c]))}}]),e}()))}}]);